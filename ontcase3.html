<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Kuntavaalit</title>
<style>
	.nimiLista {
		pointer-events: none;
		font-family: Arial;
	}
	
	.kuntaNimi {
		pointer-events: none;
		font-family: Arial;
	}
	
	.boldattu {
		font-weight: 700;
	}
	
</style>
</head>
<body>
<h1>XXX</h1>
<button class="nappi">Jatka</button>
<hr />
<script src="d3v4/d3.min.js"></script>
<script>

var svg = d3.select("body").append("svg")
	.attr("width", 500) // POIS
	.attr("height", 500) // POIS
	/*.attr("viewBox", "0 0 500 500")
	.attr("preserveAspectRatio", "xMidYMid meet");*/

var x = d3.scaleLinear()
	.domain([16, 44])
	.range([0, 500]);

var y = d3.scaleLinear()
	.domain([55, 72])
	.range([500, 0]);
	
var data = [];
var page = 0;

function vaihda(data, page) {
	//console.log("sivu:" + page);
	if (page == 0) {
		svg.selectAll(".dot")
			.transition()
				.duration(800)
				.style("fill", "darkgreen")
				.attr("r", function(d) {
					if (d.status == 2) {
						return 0;
					} else {
						return 5;
					};
				})
				.attr("transform", function() {
					var angle = (Math.random() * Math.PI * 2);
					var radius = (Math.random() * 250);
					var deltax = 100;
					var deltay =  -100;
					if (angle < Math.PI/2) {
						var deltax = Math.sin(angle)*radius;
						var deltay = -Math.cos(angle)*radius;
					} else if (angle < Math.PI) {
						angle = angle - Math.PI/2;
						var deltax = Math.sin(angle)*radius;
						var deltay = Math.cos(angle)*radius;
					} else if (angle < Math.PI*1.5) {
						angle = angle - Math.PI;
						var deltax = -Math.sin(angle)*radius;
						var deltay = Math.cos(angle)*radius;
					} else {
						angle = angle - Math.PI*1.5
						var deltax = -Math.sin(angle)*radius;
						var deltay = -Math.cos(angle)*radius;
					}
					var tulos = deltax + "," + deltay;
					return "translate(" + tulos + ")";
				});
	} else if (page == 1) {
		svg.selectAll(".status0")
			.transition()
				.duration(1000)
				.style("fill", "white")
				.attr("cy", 500);
		
		svg.selectAll(".status2")
			.transition()
				.duration(1000)
				.style("fill", "limegreen")
				.attr("r", 5);
	} else if (page == 2) {
		
		svg.selectAll(".dot")
			.data(data)
			.transition()
				.duration(1000)
				.attr("transform", "translate(0,0)")
				.attr("cx", function(d) { return x(d.lon); })
				.attr("cy", function(d) { return y(d.lat); })
				.attr("r", 0);
				
		var kuntaData = [];
		
		d3.json("ontcase3_data.json", function(error, json) {
			if (error) throw error;
			
			json.tulokset.forEach(function(d) {
				var kunta = {name: d.name, totvotes: d.totvotes, lon: d.lon, lat: d.lat};
				var nimet = [];
				d.children.forEach(function(d) {
					if (d.status != 0) {
						nimet.push(d.name);
					};
				});
				kunta.nimet = nimet;
				kunta.kuntaPaikat = nimet.length;
				kuntaData.push(kunta);
			});
			kaupungit(kuntaData);
		});
		
		function kaupungit(kuntaData) {
			svg.selectAll(".city")
			.data(kuntaData)
			.enter().append("circle")
				.attr("class", "city")
				.attr("cx", function(d) { return x(d.lon); })
				.attr("cy", function(d) { return y(d.lat); })
				.attr("r", function(d) { return 5*Math.sqrt(d.kuntaPaikat/Math.PI); })
				.style("fill", "darkgreen")
			.on("mouseover", function(d) {
				console.log(d);
				d3.select(this)
					.transition()
					.duration(200)
					.attr("r", 50)
					.style("fill", "limegreen");
				svg.append("text")
					.text(d.name)
					.attr("class", "kuntaNimi")
					.attr("x", x(d.lon)-d.name.length*4)
					.attr("y", y(d.lat)+5)
					.style("fill", "black");
				svg.append("text")
					.text("Valitut:")
					.attr("class", "nimiLista boldattu")
					.attr("x", 360)
					.attr("y", 20)
					.style("fill", "black");
				d.nimet.forEach(function(d, i) {
					svg.append("text")
						.text(d)
						.attr("class", "nimiLista")
						.attr("x", 360)
						.attr("y", 40+20*i)
						.style("fill", "black");
				});

				//TEKSTIT VALITUILLE
			})
			.on("mouseout", function(d) {
				d3.select(this).transition().duration(400).attr("r", function(d) { return d.kuntaPaikat; }).style("fill", "darkgreen");
				d3.selectAll(".nimiLista").remove();
				d3.selectAll(".kuntaNimi").remove();
			});
		};
			
	} else if (page == 3) {
		console.log("KUNKUT");
	} else {
		page = 0;
		vaihda(data, 0);
	}
}

d3.select(".nappi")
	.on("click", function(){
			if (page == 3) { page = -1; };
			//console.log("nappi");
			page = page+1;
			vaihda(data, page);
	});

d3.json("ontcase3_data.json", function(error, json) {
	if (error) throw error;
	json.tulokset.forEach(function(d) {
		var kuntaNimi = d.name;
		var kuntaVotes = d.totvotes;
		var kuntaLon = d.lon;
		var kuntaLat = d.lat;
		d.children.forEach(function(d) {
			d.kname = kuntaNimi;
			d.totvotes = kuntaVotes;
			d.lon = kuntaLon;
			d.lat = kuntaLat;
			data.push(d);
		});
	});
	
	svg.selectAll(".dot")
		.data(data)
		.enter().append("circle")
			.attr("class", function(d) {
				var luokka = "dot status" + d.status;
				return luokka;
			})
			.attr("cx", 250)
			.attr("cy", 250)
			.attr("r", 0)
			.style("fill", "darkgreen");
	//console.log(data);
	
	vaihda(data, 0);
});

</script>
Sources:
http://bl.ocks.org/mbostock/4063269
</body>
</html>
